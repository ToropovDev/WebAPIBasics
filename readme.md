# Проект на FastAPI для парсинга товаров с сайта Maxidom (Торопов Арсений Алексеевич, РИ-320934)

Файл readme.MD относится к проекту в папке Task3

Этот проект использует **FastAPI** для создания API, которое парсит товары с сайта **Maxidom** и сохраняет их в базе данных PostgreSQL. Также реализованы методы для работы с продуктами через API: добавление, редактирование и удаление.

## 1. Как настроить и запустить базу данных

В этом проекте используется **PostgreSQL** в Docker-контейнере. Так проще поднимать базу конкретно под проект. 

### Шаги для настройки базы данных:

1. **Отредактировать файл docker-compose.yml при необходимости**:

   В директории проекта уже есть файл `docker-compose.yml`, который настроен для запуска контейнера с PostgreSQL.

   ```yaml
   version: "3.3"

   services:
     db:
       image: postgres
       restart: always
       ports:
         - "5434:5432"
       environment:
         POSTGRES_DB: "maxidom_db"
         POSTGRES_USER: "maxidom_user"
         POSTGRES_PASSWORD: "12345678"
   ```

2. **Запустите контейнер с базой данных**:
   - Перейдите в директорию проекта.
   - Выполните команду:
     ```bash
     docker-compose up -d
     ```

Базово в `ports` нужно указывать `5432:5432`, но у меня запущено несколько БД, поэтому я использовал `5434:5432`.

3. **Проверьте, что база данных работает**
---

## 2. Зависимости проекта

### Шаги для установки зависимостей:

1. **Создайте виртуальное окружение**:
   - В директории проекта выполните:
     ```bash
     python -m venv venv
     ```
   - Для активации виртуального окружения:
     - **Windows**: `venv\Scripts\activate`
     - **Mac/Linux**: `source venv/bin/activate`

2. **Установите зависимости проекта**:
   - В активированном виртуальном окружении выполните команду:
     ```bash
     pip install -r requirements.txt
     ```

---

## 3. Миграции

Проект использует **Alembic** для управления миграциями базы данных. Этот инструмент я выбрал из-за его удобства, а также так как использую его во всех своих проектах 

### Шаги для применения миграций:

1. **Настройте Alembic**:
   - Убедитесь, что в файле `alembic.ini` в секции `sqlalchemy.url` указана правильная строка подключения к базе данных:
     ```ini
     sqlalchemy.url = postgresql://maxidom_user:12345678@localhost:5433/maxidom_db
     ```

2. **Примените миграции**:
   - Выполните команду для применения всех миграций:
     ```bash
     alembic upgrade heads
     ```

---

## 4. Как запустить проект

1. **Запустите сервер**:
     ```bash
     uvicorn Task3.app:app --reload
     ```

---

## 5. Как работает каждый из API методов

### 1. **POST /product/parse/**

Метод для парсинга товаров с сайта Maxidom. Пользователь передает ссылку на раздел сайта, и метод парсит все товары из этого раздела, добавляя их в базу данных.

- **Параметры**:
  - `url` (строка): Ссылка на раздел на сайте Maxidom (например, `https://www.maxidom.ru/catalog/vanny/`).
- **Ответ**:
  - Сообщение о том, сколько товаров было успешно добавлено в базу.

### 2. **GET /product/product/**

Метод для получения информации о товаре по его названию. Название продукта сравнивается с тем, что сохранено в базе данных (без учета регистра).

- **Параметры**:
  - `name` (строка): Название товара, который нужно найти.
- **Ответ**:
  - Информация о товаре, если он найден. Если товар не найден — ошибка 404.

### 3. **GET /product/section/**

Метод для получения всех товаров из определенного раздела. Если товары из этого раздела еще не были добавлены в базу, они будут сначала спарсены и затем выведены.

- **Параметры**:
  - `url` (строка): Ссылка на раздел на сайте Maxidom.
- **Ответ**:
  - Список товаров из указанного раздела.

### 4. **PUT /product/product/**

Метод для редактирования цены товара. Можно изменить цену продукта по его названию.

- **Параметры**:
  - `name` (строка): Название товара, цену которого нужно изменить.
  - `new_price` (строка): Новая цена товара.
- **Ответ**:
  - Сообщение об успешном обновлении цены товара.

### 5. **DELETE /product/product/**

Метод для удаления товара по его названию.

- **Параметры**:
  - `name` (строка): Название товара, который нужно удалить.
- **Ответ**:
  - Сообщение об успешном удалении товара.

### 6. **DELETE /product/section/**

Метод для удаления всех товаров из указанного раздела.

- **Параметры**:
  - `url` (строка): Ссылка на раздел сайта Maxidom.
- **Ответ**:
  - Сообщение об успешном удалении всех товаров в указанном разделе.


--- 
P.S. Так же в этом проекте я использовал библиотеки `black` и `ruff` для форматирования кода.

P.P.S. Не совсем понял что именно Вы имели в виду под парсингом страниц в фоне. Буду рад получить обратную связь и доработать сервис, отталкиваясь от неё. Могу реализовать как асинхронные апи-методы, так и фоновые джобы.